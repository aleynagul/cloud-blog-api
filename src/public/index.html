<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <title>Mini Blog UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            max-width: 600px;
            margin: auto;
        }

        input,
        textarea,
        button {
            display: block;
            margin: 8px 0;
            width: 100%;
            padding: 8px;
        }

        .hidden {
            display: none;
        }

        .post {
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <!-- LOGIN -->
    <section id="loginSection">
        <h2>üîê Giri≈ü Yap</h2>
        <input id="username" placeholder="Username" />
        <input id="password" placeholder="Password" type="password" />
        <button onclick="login()">Login</button>
        <p id="loginError" style="color:red;"></p>
        <button onclick="register()">Kayƒ±t Ol</button>
        <p id="authMessage"></p>
    </section>

    <!-- POSTS -->
    <section id="postsSection" class="hidden">
        <h2>üìù Postlar</h2>
        <h3>Yeni Post</h3>
        <input id="title" placeholder="Ba≈ülƒ±k" />
        <textarea id="content" placeholder="ƒ∞√ßerik"></textarea>
        <button onclick="addPost()">Post Ekle</button>
        <h3>Post Listesi</h3>
        <div id="postsList"></div>
        <button onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
    </section>

    <script>
        let token = "";
        const API_URL = "http://localhost:5006";

        async function login() {
            const res = await fetch(`${API_URL}/auth/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    username: username.value,
                    password: password.value
                })
            });

            if (!res.ok) {
                loginError.textContent = "Giri≈ü ba≈üarƒ±sƒ±z";
                return;
            }

            const data = await res.json();
            token = data.token;

            loginSection.classList.add("hidden");
            postsSection.classList.remove("hidden");

            getPosts();
        }
        async function getPosts() {
            const res = await fetch(`${API_URL}/posts`, {
                headers: {
                    Authorization: `Bearer ${token}`
                }
            });

            const result = await res.json();
            postsList.innerHTML = "";

            result.data.forEach(p => {
                const div = document.createElement("div");
                div.className = "post";

                div.innerHTML = `<strong>${p.title}</strong> <p>${p.content}</p> <button onclick="deletePost(${p.id})">Sil</button>`;

                postsList.appendChild(div);
            });
        }

        async function deletePost(id) {
            await fetch(`${API_URL}/posts/${id}`, {
                method: "DELETE",
                headers: {
                    Authorization: `Bearer ${token}`
                }
            });

            getPosts();
        }

        async function addPost() {
            await fetch(`${API_URL}/posts`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${token}`
                },
                body: JSON.stringify({
                    title: title.value,
                    content: content.value
                })
            });

            title.value = "";
            content.value = "";

            getPosts();
        }
        function logout() {
            token = "";

            postsSection.classList.add("hidden");
            loginSection.classList.remove("hidden");

            authMessage.textContent = "";
        }



        async function register() {
            const res = await fetch(`${API_URL}/auth/register`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    username: username.value,
                    password: password.value
                })
            });

            const data = await res.json();

            if (res.ok) {
                registerMsg.style.color = "green";
                registerMsg.textContent = "Kayƒ±t ba≈üarƒ±lƒ±, giri≈ü yapabilirsin.";
            } else {
                registerMsg.style.color = "red";
                registerMsg.textContent = data.message;
            }
        }

    </script>

</body>

</html>